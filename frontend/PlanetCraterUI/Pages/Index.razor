@page "/"
@page "/index"

<InputFile OnChange="Upload" />

<p>@Message</p>

@if (ImageResult != null)
{
    <img src="@ImageResult" style="max-width:100%; margin-top:20px;" />
    <p><b>Crater Coverage:</b> @Coverage %</p>
}

@code {
    string? ImageResult;
    string? Message;
    double Coverage;

    async Task Upload(InputFileChangeEventArgs e)
    {
        var file = e.File;

        var content = new MultipartFormDataContent();
        content.Add(
            new StreamContent(file.OpenReadStream(10_000_000)),
            "file",
            file.Name
        );

        try
        {
            var client = new HttpClient();
            var response = await client.PostAsync(
                "http://localhost:8000/detect",
                content
            );

            var json = await response.Content.ReadFromJsonAsync<dynamic>();

            if (json.success == true)
            {
                ImageResult = $"data:image/png;base64,{json.image_base64}";
                Coverage = json.coverage;
                Message = null;
            }
            else
            {
                Message = json.message;
            }
        }
        catch (Exception ex)
        {
            Message = "An error occurred while processing the image.";
        }
    }
}
